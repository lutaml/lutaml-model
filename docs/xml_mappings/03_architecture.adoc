= Architecture overview

== Component diagram

.XML namespace architecture
[source]
----
╔═══════════════════════════════════════════════════════════════════╗
║                       Lutaml::Model::Xml                          ║
╚═══════════════════════════════════════════════════════════════════╝

┌───────────────────────────────────────────────────────────────────┐
│                      Namespace Layer                              │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │           XmlNamespace (Base Class)                       │  │
│  │  • uri, schema_location, prefix_default                   │  │
│  │  • element_form_default, attribute_form_default           │  │
│  │  • imports, includes, version, documentation              │  │
│  └───────────────────────────────────────────────────────────┘  │
│                              ▲                                    │
│                              │ inherits                           │
│                              │                                    │
│  ┌──────────────────┐   ┌──────────────────┐                    │
│  │ ContactNamespace │   │ AddressNamespace │  (User-defined)    │
│  │ CeramicNamespace │   │ GlazeNamespace   │                    │
│  └──────────────────┘   └──────────────────┘                    │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────┐
│                      Mapping Layer                                │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                 Xml::Mapping                              │  │
│  │  • element(name) - declare element                        │  │
│  │  • root(name, mixed:, ordered:) - backward compat         │  │
│  │  • mixed_content() - enable mixed mode                    │  │
│  │  • namespace(XmlNamespace | String)                       │  │
│  │  • documentation(text)                                    │  │
│  │  • type_name(name)                                        │  │
│  │  • map_element, map_attribute, map_content                │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                   │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                 Xml::MappingRule                          │  │
│  │  • form: :qualified | :unqualified                        │  │
│  │  • documentation: "annotation text"                       │  │
│  │  • namespace:, prefix: per-mapping overrides              │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────┐
│                      Type Layer                                   │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │              Type::Value (Enhanced)                       │  │
│  │  • self.xsd_type() - XSD type name                        │  │
│  │  • self.xsd_namespace() - Type's namespace                │  │
│  │  • xml block support (future)                             │  │
│  └───────────────────────────────────────────────────────────┘  │
│                              ▲                                    │
│                              │ inherits                           │
│                              │                                    │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐       │
│  │ String   │ Integer  │ Date     │ Duration │ QName    │       │
│  │ Float    │ Boolean  │ DateTime │ Uri      │ Base64   │       │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘       │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────────────────┐
│                      Schema Generation                            │
├───────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │          Schema::XsdSchema (Generator)                    │  │
│  │  • Element/Type inference from mappings                   │  │
│  │  • Qualification control from namespace metadata          │  │
│  │  • Multi-schema support (imports/includes)                │  │
│  │  • Documentation annotations                              │  │
│  └───────────────────────────────────────────────────────────┘  │
│                              │                                    │
│                              ▼                                    │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │          Schema::SchemaBuilder                            │  │
│  │  Adapters: Nokogiri, Oga                                  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
----

== Data flow

=== Instance to XML

.Serialization data flow with namespace metadata
[source]
----
Model Instance
      │
      │ 1. Get XML mapping
      ▼
Xml::Mapping
      │
      │ 2. Resolve namespace metadata
      ▼
XmlNamespace instance
      │
      │ 3. Apply qualification rules
      ▼
Qualified/Unqualified elements
      │
      │ 4. Generate XML via adapter
      ▼
XML String with proper namespaces
----

=== XML to instance

.Deserialization with namespace awareness
[source]
----
XML String
      │
      │ 1. Parse via adapter
      ▼
XML Document
      │
      │ 2. Match elements by namespace URI (not prefix!)
      ▼
Matched elements
      │
      │ 3. Extract values
      ▼
Model Instance
----

=== XSD generation data flow

.XSD generation with full namespace metadata
[source]
----
Model Class
      │
      ┌──────────┴─────────┐
      │                    │
      ▼                    ▼
Xml::Mapping      XmlNamespace class
      │                    │
      │ element_name       │ uri, prefix_default
      │ type_name          │ element_form_default
      │ documentation      │ attribute_form_default
      │                    │ imports, includes
      │                    │ version, documentation
      │                    │
      └─────────┬──────────┘
                │
                │ Combine metadata
                ▼
      Schema::XsdSchema
                │
                │ Generate XSD constructs
                ▼
      Schema::SchemaBuilder
                │
                │ Serialize to XML
                ▼
      XSD String (W3C compliant)
----

== Key components

[`XmlNamespace`](../lib/lutaml/model/xml_namespace.rb):: Centralized namespace
metadata following W3C specs. Defines URI, prefix, qualification defaults,
imports/includes, versioning.

[`Xml::Mapping`](../lib/lutaml/model/xml/mapping.rb):: Element/attribute
mapping declarations. Uses `element()` for element names, references
`XmlNamespace` classes for namespace configuration.

[`Xml::MappingRule`](../lib/lutaml/model/xml/mapping_rule.rb):: Individual
element or attribute mapping with `form:` and `documentation:` options for
fine-grained control.

[`Schema::XsdSchema`](../lib/lutaml/model/schema/xsd_schema.rb):: XSD
generation engine that infers element/type structure and applies namespace
metadata.

[`Schema::SchemaBuilder`](../lib/lutaml/model/schema/schema_builder.rb)::
Adapter-based XSD serialization supporting Nokogiri and Oga.